<!DOCTYPE html>

<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>API Auto-Test</title>
<style>body{font-family:-apple-system,sans-serif;background:#111;color:#eee;padding:16px;font-size:13px}
#out{background:#1a1a2e;padding:12px;border-radius:10px;white-space:pre-wrap;word-break:break-all;font-family:monospace;font-size:11px;line-height:1.7;min-height:200px}
.ok{color:#10b981}.err{color:#ef4444}.warn{color:#f59e0b}
button{width:100%;padding:14px;background:#6366f1;color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:700;margin:8px 0;cursor:pointer}
input{width:100%;padding:12px;background:#222;border:2px solid #444;color:#fff;border-radius:10px;font-size:16px;margin:6px 0;outline:none}
</style></head>
<body>
<h2>ğŸ”§ Auto-Teste v2</h2>
<input type="text" id="k" placeholder="Key (ou deixa vazio para usar a guardada)">
<button onclick="go()">ğŸš€ Testar Agora</button>
<button onclick="goHard()" style="background:#f59e0b">âš¡ Testar com key sandbox</button>
<div id="out">Toca num botÃ£o â†‘</div>
<script>
var O=document.getElementById('out');
function w(m,c){O.innerHTML+='<span class="'+(c||'')+'">'+m+'</span>\n';O.scrollTop=O.scrollHeight;}

async function test(key){
O.innerHTML=â€™â€™;
w(â€˜ğŸ”‘ Key: â€˜+key.substring(0,6)+â€™â€¦â€™+key.slice(-4)+â€™ (â€™+key.length+â€™ chars)â€™);
w(â€™ğŸ“… â€™+new Date().toISOString());
w(â€˜ğŸŒ UserAgent: â€˜+navigator.userAgent.substring(0,80));
w(â€™â€™);

var now=Math.floor(Date.now()/1000);
var ago=now-2592000;

w(â€˜â”â”â” 1. fetch() test â”â”â”â€™,â€˜warnâ€™);
try{
w(â€˜Fetchingâ€¦â€™);
var r=await fetch(â€˜https://finnhub.io/api/v1/quote?symbol=AAPL&token=â€™+key);
w(â€™âœ… fetch worked! Status: â€™+r.status,â€˜okâ€™);
var txt=await r.text();
w(â€™Response: â€™+txt);
try{var j=JSON.parse(txt);w(â€˜AAPL Price: $â€™+j.c,â€˜okâ€™);}catch(e){w(â€™Parse error: â€™+e.message,â€˜errâ€™);}
}catch(e){
w(â€˜âŒ fetch FAILED: â€˜+e.message,â€˜errâ€™);
w(â€™â€™);
w(â€˜Trying XMLHttpRequestâ€¦â€™,â€˜warnâ€™);
try{
var xhr=new XMLHttpRequest();
xhr.open(â€˜GETâ€™,â€˜https://finnhub.io/api/v1/quote?symbol=AAPL&token=â€™+key,false);
xhr.send();
w(â€™XHR Status: â€™+xhr.status);
w(â€™XHR Response: â€™+xhr.responseText);
}catch(e2){w(â€˜âŒ XHR also failed: â€˜+e2.message,â€˜errâ€™);}
}
w(â€™â€™);

w(â€˜â”â”â” 2. Candles test â”â”â”â€™,â€˜warnâ€™);
try{
var r2=await fetch(â€˜https://finnhub.io/api/v1/stock/candle?symbol=AAPL&resolution=D&from=â€™+ago+â€™&to=â€™+now+â€™&token=â€™+key);
w(â€™Status: â€™+r2.status,â€˜okâ€™);
var t2=await r2.text();
w(â€˜Size: â€˜+t2.length+â€™ bytesâ€™);
try{var j2=JSON.parse(t2);w(j2.c?â€˜âœ… â€˜+j2.c.length+â€™ candles! Last: $â€™+j2.c[j2.c.length-1]:â€™âš ï¸ â€™+t2.substring(0,100),j2.c?â€˜okâ€™:â€˜warnâ€™);}catch(e){w(â€™Data: â€™+t2.substring(0,150));}
}catch(e){w(â€˜âŒ â€˜+e.message,â€˜errâ€™);}
w(â€™â€™);
w(â€˜â”â”â” DONE â”â”â”â€™,â€˜warnâ€™);
}

function go(){
var k=document.getElementById(â€˜kâ€™).value.trim();
if(!k){w(â€˜Mete a key no campo!â€™,â€˜errâ€™);return;}
// Remove duplicates - if key appears twice
if(k.length>30){var half=Math.floor(k.length/2);if(k.substring(0,half)===k.substring(half)||k.substring(0,half)===k.substring(half,half*2)){k=k.substring(0,half);w(â€™âš ï¸ Key duplicada detectada, usando: â€™+k,â€˜warnâ€™);}}
test(k);
}

function goHard(){
// Use the sandbox key from Finnhub docs
test(â€˜sandbox_c0b1234defghijklmnâ€™);
}

// Auto-detect saved key
try{var sk=localStorage.getItem(â€˜cfdk6â€™)||localStorage.getItem(â€˜fhkâ€™);if(sk){document.getElementById(â€˜kâ€™).value=sk;w(â€˜Key guardada encontrada: â€˜+sk.substring(0,6)+â€™â€¦â€™,â€˜okâ€™);}}catch(e){}
</script>

</body></html>